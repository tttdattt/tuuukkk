<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>DAT PREMIUM HUB - Storage Edition</title>
    <style>
        :root { --accent: #a29bfe; --bg: #030305; --panel: rgba(20, 20, 25, 0.95); --glass: rgba(255, 255, 255, 0.05); }
        body { margin: 0; overflow: hidden; background: var(--bg); color: white; font-family: 'Inter', -apple-system, sans-serif; width: 100vw; height: 100vh; }
        
        .container { display: flex; width: 100%; height: 100%; }
        .side { flex: 1; height: 100%; position: relative; overflow: hidden; }
        .video-side { background: #000; border-right: 1px solid rgba(255,255,255,0.05); }
        .game-side { background: radial-gradient(circle at center, #0a0a15 0%, #030305 100%); }

        /* メインURLバー */
        .main-controls {
            position: absolute; top: 20px; left: 20px; right: 20px; z-index: 10;
            display: flex; gap: 10px; padding: 10px; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(20px); border-radius: 12px; border: 1px solid var(--glass);
        }

        .video-wrapper { width: 100%; height: 100%; }
        iframe { width: 100%; height: 100%; border: none; }

        /* 設定ボタン */
        .settings-trigger {
            position: absolute; top: 25px; right: 25px; z-index: 100;
            width: 45px; height: 45px; border-radius: 50%; background: var(--panel);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            backdrop-filter: blur(10px); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); border: 1px solid var(--glass);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .settings-trigger:hover { transform: rotate(90deg); background: var(--accent); }

        /* サイドパネル */
        .side-panel {
            position: fixed; top: 0; right: -420px; width: 380px; height: 100%;
            background: var(--panel); backdrop-filter: blur(50px); z-index: 95;
            transition: 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: -20px 0 50px rgba(0,0,0,0.8); padding: 90px 30px 30px;
            display: flex; flex-direction: column; gap: 25px; border-left: 1px solid var(--glass);
            box-sizing: border-box;
        }
        .side-panel.open { right: 0; }

        /* UIパーツ */
        .input-group { display: flex; flex-direction: column; gap: 12px; background: rgba(255,255,255,0.03); padding: 18px; border-radius: 18px; }
        input { background: rgba(0,0,0,0.3); border: 1px solid var(--glass); color: white; padding: 12px; border-radius: 10px; outline: none; font-size: 0.85rem; }
        .btn-row { display: flex; gap: 8px; }
        .btn { flex: 1; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-size: 0.75rem; transition: 0.2s; background: rgba(255,255,255,0.1); color: white; }
        .btn:hover { background: var(--accent); color: #000; font-weight: bold; }

        /* プレイリスト表示 */
        .playlist-scroll { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .playlist-card { background: rgba(0,0,0,0.2); border-radius: 15px; padding: 15px; border: 1px solid var(--glass); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-header h4 { margin: 0; font-size: 0.8rem; color: var(--accent); letter-spacing: 2px; }
        .btn-del-list { font-size: 0.6rem; color: #ff7675; cursor: pointer; background: none; border: 1px solid rgba(255,118,117,0.3); border-radius: 4px; padding: 2px 5px; }
        
        .vid-item { 
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.75rem; padding: 8px; border-radius: 8px; transition: 0.2s; 
        }
        .vid-item:hover { background: rgba(255,255,255,0.05); }
        .vid-name { flex: 1; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.6; }
        .vid-name:hover { opacity: 1; color: var(--accent); }
        .btn-del-vid { color: #555; cursor: pointer; margin-left: 10px; font-weight: bold; padding: 0 5px; }
        .btn-del-vid:hover { color: #ff7675; }

        /* ゲーム */
        #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .game-ui { position: absolute; top: 100px; right: 40px; text-align: right; pointer-events: none; z-index: 5; }
        .score { font-size: 5rem; font-weight: 100; color: var(--accent); line-height: 1; opacity: 0.8; }
        .combo { font-size: 1.2rem; color: #fff; opacity: 0.3; letter-spacing: 8px; margin-top: 5px; }
        .reset-score { position: absolute; bottom: 30px; left: 30px; opacity: 0.3; cursor: pointer; font-size: 0.7rem; border: none; background: none; color: white; z-index: 5; }
    </style>
</head>
<body>

<div class="container">
    <div class="side video-side">
        <div class="main-controls">
            <input type="text" id="main-url" placeholder="YouTube URLをペースト...">
            <button class="btn" onclick="quickPaste('main-url')">PASTE</button>
            <button class="btn" style="background:var(--accent); color:#000;" onclick="loadFrom('main-url')">PLAY</button>
        </div>
        <div class="video-wrapper">
            <iframe id="player" src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&mute=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>

    <div class="side game-side" id="game-container">
        <div class="game-ui">
            <div class="score" id="score">0</div>
            <div class="combo" id="combo">COMBO 0</div>
        </div>
        <canvas id="canvas"></canvas>
        <button class="reset-score" onclick="resetGame()">RESET SCORE</button>
    </div>
</div>

<div class="settings-trigger" onclick="togglePanel()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
</div>

<div class="side-panel" id="sidePanel">
    <h3 style="margin:0; font-weight:200; letter-spacing:3px;">SETTINGS</h3>
    <div class="input-group">
        <input type="text" id="panel-url" placeholder="URLを追加または再生...">
        <div class="btn-row">
            <button class="btn" onclick="quickPaste('panel-url')">PASTE</button>
            <button class="btn" onclick="loadFrom('panel-url')">PLAY</button>
        </div>
        <div class="btn-row">
            <select id="target-list" style="flex:2; background:#000; color:white; border:1px solid var(--glass); border-radius:10px; padding:5px;"></select>
            <button class="btn" style="background:#55efc4; color:#000; font-weight:bold;" onclick="saveToPlaylist()">ADD</button>
        </div>
    </div>
    <div class="playlist-scroll" id="playlistArea"></div>
</div>

<script>
    // --- Data Persistence (LocalStorage) ---
    const STORAGE_KEY = 'dat_vfinal_db';
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || Array.from({length: 10}, (_, i) => ({ name: `Playlist ${i+1}`, vids: [] }));
    
    function saveDB() { 
        localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); 
        renderUI(); 
    }

    function togglePanel() { document.getElementById('sidePanel').classList.toggle('open'); }

    function renderUI() {
        const area = document.getElementById('playlistArea');
        const sel = document.getElementById('target-list');
        area.innerHTML = ''; sel.innerHTML = '';
        db.forEach((list, i) => {
            const opt = document.createElement('option'); opt.value = i; opt.innerText = list.name;
            sel.appendChild(opt);

            const card = document.createElement('div');
            card.className = 'playlist-card';
            
            const header = document.createElement('div');
            header.className = 'card-header';
            header.innerHTML = `<h4>${list.name.toUpperCase()}</h4>`;
            const delListBtn = document.createElement('button');
            delListBtn.className = 'btn-del-list';
            delListBtn.innerText = 'Reset List';
            delListBtn.onclick = () => { if(confirm('リストを空にしますか？')) { db[i].vids = []; saveDB(); } };
            header.appendChild(delListBtn);
            card.appendChild(header);

            list.vids.forEach((id, vIdx) => {
                const item = document.createElement('div');
                item.className = 'vid-item';
                
                const name = document.createElement('span');
                name.className = 'vid-name';
                name.innerText = `ID: ${id}`;
                name.onclick = () => { playById(id); togglePanel(); };
                
                const delVidBtn = document.createElement('span');
                delVidBtn.className = 'btn-del-vid';
                delVidBtn.innerText = '×';
                delVidBtn.onclick = (e) => { e.stopPropagation(); db[i].vids.splice(vIdx, 1); saveDB(); };

                item.appendChild(name);
                item.appendChild(delVidBtn);
                card.appendChild(item);
            });
            area.appendChild(card);
        });
    }

    // --- Actions ---
    function extractID(url) {
        const reg = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
        const m = url.match(reg); return (m && m[7].length === 11) ? m[7] : null;
    }
    function loadFrom(inputId) { const id = extractID(document.getElementById(inputId).value); if(id) playById(id); }
    function playById(id) { document.getElementById('player').src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1`; }
    async function quickPaste(inputId) { try { const t = await navigator.clipboard.readText(); document.getElementById(inputId).value = t; } catch(e){} }
    function saveToPlaylist() {
        const id = extractID(document.getElementById('panel-url').value);
        const idx = document.getElementById('target-list').value;
        if(id && db[idx].vids.length < 50) { 
            db[idx].vids.push(id); 
            saveDB(); 
            document.getElementById('panel-url').value = ''; 
        }
    }

    // --- Game ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('game-container');
    let w, h, score = 0, combo = 0, stars = [], particles = [];

    function initCanvas() { w = canvas.width = container.clientWidth; h = canvas.height = container.clientHeight; }
    window.addEventListener('resize', initCanvas);
    initCanvas();

    class Star {
        constructor() { this.init(); }
        init() {
            this.x = Math.random() * w; this.y = h + Math.random() * 200;
            this.r = Math.random() * 10 + 8; this.v = -(Math.random() * 2 + 1);
            this.h = 240 + Math.random() * 40;
        }
        update() { this.y += this.v; if(this.y < -50) this.init(); }
        draw() {
            ctx.shadowBlur = 25; ctx.shadowColor = `hsla(${this.h},100%,70%,0.5)`;
            ctx.fillStyle = `hsla(${this.h},100%,90%,0.9)`;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    class P {
        constructor(x,y,h) { this.x=x; this.y=y; this.h=h; this.vx=(Math.random()-0.5)*12; this.vy=(Math.random()-0.5)*12; this.l=1; }
        update() { this.x+=this.vx; this.y+=this.vy; this.l-=0.025; }
        draw() { ctx.fillStyle=`hsla(${this.h},100%,70%,${this.l})`; ctx.beginPath(); ctx.arc(this.x,this.y,2.5,0,Math.PI*2); ctx.fill(); }
    }

    for(let i=0; i<18; i++) stars.push(new Star());

    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
        let hit = false;
        stars.forEach(s => {
            if(Math.sqrt((mx-s.x)**2 + (my-s.y)**2) < s.r + 40) {
                hit = true; score += 100 * (combo + 1); combo++;
                for(let i=0; i<25; i++) particles.push(new P(s.x, s.y, s.h));
                s.init();
            }
        });
        if(!hit) combo = 0;
        document.getElementById('score').innerText = score.toLocaleString();
        document.getElementById('combo').innerText = `COMBO ${combo}`;
    });

    function resetGame() { score=0; combo=0; document.getElementById('score').innerText="0"; document.getElementById('combo').innerText="COMBO 0"; }

    function animate() {
        ctx.fillStyle = 'rgba(3, 3, 5, 0.4)'; ctx.fillRect(0,0,w,h);
        stars.forEach(s => { s.update(); s.draw(); });
        particles = particles.filter(p => p.l > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }

    renderUI(); animate();
</script>
</body>
</html></title>
    <style>
        :root { --accent: #a29bfe; --bg: #030305; --panel: rgba(20, 20, 25, 0.95); --glass: rgba(255, 255, 255, 0.05); }
        body { margin: 0; overflow: hidden; background: var(--bg); color: white; font-family: 'Inter', -apple-system, sans-serif; width: 100vw; height: 100vh; }
        
        .container { display: flex; width: 100%; height: 100%; }
        .side { flex: 1; height: 100%; position: relative; overflow: hidden; }
        .video-side { background: #000; border-right: 1px solid rgba(255,255,255,0.05); }
        .game-side { background: radial-gradient(circle at center, #0a0a15 0%, #030305 100%); }

        /* メインURLバー */
        .main-controls {
            position: absolute; top: 20px; left: 20px; right: 20px; z-index: 10;
            display: flex; gap: 10px; padding: 10px; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(20px); border-radius: 12px; border: 1px solid var(--glass);
        }

        .video-wrapper { width: 100%; height: 100%; }
        iframe { width: 100%; height: 100%; border: none; }

        /* 設定ボタン */
        .settings-trigger {
            position: absolute; top: 25px; right: 25px; z-index: 100;
            width: 45px; height: 45px; border-radius: 50%; background: var(--panel);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            backdrop-filter: blur(10px); transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); border: 1px solid var(--glass);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .settings-trigger:hover { transform: rotate(90deg); background: var(--accent); }

        /* サイドパネル */
        .side-panel {
            position: fixed; top: 0; right: -420px; width: 380px; height: 100%;
            background: var(--panel); backdrop-filter: blur(50px); z-index: 95;
            transition: 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: -20px 0 50px rgba(0,0,0,0.8); padding: 90px 30px 30px;
            display: flex; flex-direction: column; gap: 25px; border-left: 1px solid var(--glass);
            box-sizing: border-box;
        }
        .side-panel.open { right: 0; }

        /* UIパーツ */
        .input-group { display: flex; flex-direction: column; gap: 12px; background: rgba(255,255,255,0.03); padding: 18px; border-radius: 18px; }
        input { background: rgba(0,0,0,0.3); border: 1px solid var(--glass); color: white; padding: 12px; border-radius: 10px; outline: none; font-size: 0.85rem; }
        .btn-row { display: flex; gap: 8px; }
        .btn { flex: 1; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-size: 0.75rem; transition: 0.2s; background: rgba(255,255,255,0.1); color: white; }
        .btn:hover { background: var(--accent); color: #000; font-weight: bold; }

        /* プレイリスト表示 */
        .playlist-scroll { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .playlist-card { background: rgba(0,0,0,0.2); border-radius: 15px; padding: 15px; border: 1px solid var(--glass); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card-header h4 { margin: 0; font-size: 0.8rem; color: var(--accent); letter-spacing: 2px; }
        .btn-del-list { font-size: 0.6rem; color: #ff7675; cursor: pointer; background: none; border: 1px solid rgba(255,118,117,0.3); border-radius: 4px; padding: 2px 5px; }
        
        .vid-item { 
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.75rem; padding: 8px; border-radius: 8px; transition: 0.2s; 
        }
        .vid-item:hover { background: rgba(255,255,255,0.05); }
        .vid-name { flex: 1; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.6; }
        .vid-name:hover { opacity: 1; color: var(--accent); }
        .btn-del-vid { color: #555; cursor: pointer; margin-left: 10px; font-weight: bold; padding: 0 5px; }
        .btn-del-vid:hover { color: #ff7675; }

        /* ゲーム */
        #canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .game-ui { position: absolute; top: 100px; right: 40px; text-align: right; pointer-events: none; z-index: 5; }
        .score { font-size: 5rem; font-weight: 100; color: var(--accent); line-height: 1; opacity: 0.8; }
        .combo { font-size: 1.2rem; color: #fff; opacity: 0.3; letter-spacing: 8px; margin-top: 5px; }
        .reset-score { position: absolute; bottom: 30px; left: 30px; opacity: 0.3; cursor: pointer; font-size: 0.7rem; border: none; background: none; color: white; z-index: 5; }
    </style>
</head>
<body>

<div class="container">
    <div class="side video-side">
        <div class="main-controls">
            <input type="text" id="main-url" placeholder="YouTube URLをペースト...">
            <button class="btn" onclick="quickPaste('main-url')">PASTE</button>
            <button class="btn" style="background:var(--accent); color:#000;" onclick="loadFrom('main-url')">PLAY</button>
        </div>
        <div class="video-wrapper">
            <iframe id="player" src="https://www.youtube.com/embed/dQw4w9WgXcQ?enablejsapi=1&mute=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>

    <div class="side game-side" id="game-container">
        <div class="game-ui">
            <div class="score" id="score">0</div>
            <div class="combo" id="combo">COMBO 0</div>
        </div>
        <canvas id="canvas"></canvas>
        <button class="reset-score" onclick="resetGame()">RESET SCORE</button>
    </div>
</div>

<div class="settings-trigger" onclick="togglePanel()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
</div>

<div class="side-panel" id="sidePanel">
    <h3 style="margin:0; font-weight:200; letter-spacing:3px;">SETTINGS</h3>
    <div class="input-group">
        <input type="text" id="panel-url" placeholder="URLを追加または再生...">
        <div class="btn-row">
            <button class="btn" onclick="quickPaste('panel-url')">PASTE</button>
            <button class="btn" onclick="loadFrom('panel-url')">PLAY</button>
        </div>
        <div class="btn-row">
            <select id="target-list" style="flex:2; background:#000; color:white; border:1px solid var(--glass); border-radius:10px; padding:5px;"></select>
            <button class="btn" style="background:#55efc4; color:#000; font-weight:bold;" onclick="saveToPlaylist()">ADD</button>
        </div>
    </div>
    <div class="playlist-scroll" id="playlistArea"></div>
</div>

<script>
    // --- Data Persistence (LocalStorage) ---
    const STORAGE_KEY = 'dat_vfinal_db';
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || Array.from({length: 10}, (_, i) => ({ name: `Playlist ${i+1}`, vids: [] }));
    
    function saveDB() { 
        localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); 
        renderUI(); 
    }

    function togglePanel() { document.getElementById('sidePanel').classList.toggle('open'); }

    function renderUI() {
        const area = document.getElementById('playlistArea');
        const sel = document.getElementById('target-list');
        area.innerHTML = ''; sel.innerHTML = '';
        db.forEach((list, i) => {
            const opt = document.createElement('option'); opt.value = i; opt.innerText = list.name;
            sel.appendChild(opt);

            const card = document.createElement('div');
            card.className = 'playlist-card';
            
            const header = document.createElement('div');
            header.className = 'card-header';
            header.innerHTML = `<h4>${list.name.toUpperCase()}</h4>`;
            const delListBtn = document.createElement('button');
            delListBtn.className = 'btn-del-list';
            delListBtn.innerText = 'Reset List';
            delListBtn.onclick = () => { if(confirm('リストを空にしますか？')) { db[i].vids = []; saveDB(); } };
            header.appendChild(delListBtn);
            card.appendChild(header);

            list.vids.forEach((id, vIdx) => {
                const item = document.createElement('div');
                item.className = 'vid-item';
                
                const name = document.createElement('span');
                name.className = 'vid-name';
                name.innerText = `ID: ${id}`;
                name.onclick = () => { playById(id); togglePanel(); };
                
                const delVidBtn = document.createElement('span');
                delVidBtn.className = 'btn-del-vid';
                delVidBtn.innerText = '×';
                delVidBtn.onclick = (e) => { e.stopPropagation(); db[i].vids.splice(vIdx, 1); saveDB(); };

                item.appendChild(name);
                item.appendChild(delVidBtn);
                card.appendChild(item);
            });
            area.appendChild(card);
        });
    }

    // --- Actions ---
    function extractID(url) {
        const reg = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
        const m = url.match(reg); return (m && m[7].length === 11) ? m[7] : null;
    }
    function loadFrom(inputId) { const id = extractID(document.getElementById(inputId).value); if(id) playById(id); }
    function playById(id) { document.getElementById('player').src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1`; }
    async function quickPaste(inputId) { try { const t = await navigator.clipboard.readText(); document.getElementById(inputId).value = t; } catch(e){} }
    function saveToPlaylist() {
        const id = extractID(document.getElementById('panel-url').value);
        const idx = document.getElementById('target-list').value;
        if(id && db[idx].vids.length < 50) { 
            db[idx].vids.push(id); 
            saveDB(); 
            document.getElementById('panel-url').value = ''; 
        }
    }

    // --- Game ---
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('game-container');
    let w, h, score = 0, combo = 0, stars = [], particles = [];

    function initCanvas() { w = canvas.width = container.clientWidth; h = canvas.height = container.clientHeight; }
    window.addEventListener('resize', initCanvas);
    initCanvas();

    class Star {
        constructor() { this.init(); }
        init() {
            this.x = Math.random() * w; this.y = h + Math.random() * 200;
            this.r = Math.random() * 10 + 8; this.v = -(Math.random() * 2 + 1);
            this.h = 240 + Math.random() * 40;
        }
        update() { this.y += this.v; if(this.y < -50) this.init(); }
        draw() {
            ctx.shadowBlur = 25; ctx.shadowColor = `hsla(${this.h},100%,70%,0.5)`;
            ctx.fillStyle = `hsla(${this.h},100%,90%,0.9)`;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    class P {
        constructor(x,y,h) { this.x=x; this.y=y; this.h=h; this.vx=(Math.random()-0.5)*12; this.vy=(Math.random()-0.5)*12; this.l=1; }
        update() { this.x+=this.vx; this.y+=this.vy; this.l-=0.025; }
        draw() { ctx.fillStyle=`hsla(${this.h},100%,70%,${this.l})`; ctx.beginPath(); ctx.arc(this.x,this.y,2.5,0,Math.PI*2); ctx.fill(); }
    }

    for(let i=0; i<18; i++) stars.push(new Star());

    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
        let hit = false;
        stars.forEach(s => {
            if(Math.sqrt((mx-s.x)**2 + (my-s.y)**2) < s.r + 40) {
                hit = true; score += 100 * (combo + 1); combo++;
                for(let i=0; i<25; i++) particles.push(new P(s.x, s.y, s.h));
                s.init();
            }
        });
        if(!hit) combo = 0;
        document.getElementById('score').innerText = score.toLocaleString();
        document.getElementById('combo').innerText = `COMBO ${combo}`;
    });

    function resetGame() { score=0; combo=0; document.getElementById('score').innerText="0"; document.getElementById('combo').innerText="COMBO 0"; }

    function animate() {
        ctx.fillStyle = 'rgba(3, 3, 5, 0.4)'; ctx.fillRect(0,0,w,h);
        stars.forEach(s => { s.update(); s.draw(); });
        particles = particles.filter(p => p.l > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }

    renderUI(); animate();
</script>
</body>
</html>