<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>通貨換算</title>
<style>
:root {
  --bg-image: linear-gradient(135deg, #85a1f2 0%, #f2cfef 100%);
  --glass-bg: rgba(255, 255, 255, 0.35);
  --glass-border: rgba(255, 255, 255, 0.5);
  --glass-inner-glow: inset 0 0 15px rgba(255, 255, 255, 0.2);
  --card-bg: rgba(255, 255, 255, 0.6);
  --text-main: #1d1d1f;
  --text-muted: #48484a;
  --accent: #1d1d1f;
  --accent-fg: #ffffff;
  --key-bg: rgba(255, 255, 255, 0.4);
  --shadow: 0 12px 40px rgba(0,0,0,0.08);
  --font-family: "Hiragino Maru Gothic ProN", "Hiragino Sans", "Rounded Mplus 1c", sans-serif;
}

[data-theme="dark"] {
  --bg-image: linear-gradient(135deg, #09090b 0%, #1e1e2f 100%);
  --glass-bg: rgba(30, 30, 35, 0.4);
  --glass-border: rgba(255, 255, 255, 0.1);
  --glass-inner-glow: inset 0 0 10px rgba(255, 255, 255, 0.05);
  --card-bg: rgba(40, 40, 45, 0.7);
  --text-main: #f5f5f7;
  --text-muted: #aeaeb2;
  --accent: #ffffff;
  --accent-fg: #000000;
  --key-bg: rgba(255, 255, 255, 0.1);
  --shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
}

* { box-sizing: border-box; font-family: var(--font-family); }

html, body {
  height: 100%; margin: 0;
  background: var(--bg-image); background-attachment: fixed;
  color: var(--text-main);
  display: flex; align-items: center; justify-content: center;
}

.app { 
  max-width: 1200px; width: 100%; padding: 20px; 
  display: flex; gap: 24px; align-items: stretch; justify-content: center;
}

.glass-panel {
  background: var(--glass-bg);
  backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow), var(--glass-inner-glow);
  border-radius: 32px;
}

/* アニメーション設定 */
button, .key, select {
  transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.3s, box-shadow 0.3s;
  cursor: pointer; outline: none;
}
button:hover, .key:hover, select:hover { transform: scale(1.05); }
button:active, .key:active, select:active { transform: scale(0.92); transition: transform 0.1s; }

/* サイドバー */
.sidebar { width: 280px; padding: 24px; display: flex; flex-direction: column; gap: 16px; flex-shrink: 0; }
select {
  appearance: none; width: 100%; padding: 14px;
  background: var(--card-bg); color: var(--text-main);
  border: 1px solid var(--glass-border); border-radius: 18px;
  font-size: 16px; font-weight: 800;
}

/* メインエリア: 横幅をしっかり確保 */
.main { flex: 1; padding: 30px; display: flex; flex-direction: column; gap: 20px; }
.top-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }

.panel { display: flex; gap: 30px; align-items: flex-start; }

/* 入力・結果エリアを固定幅で広げる */
.input-area { flex: 1; display: flex; flex-direction: column; gap: 20px; min-width: 400px; }

.amount-display, .result-bar {
  width: 100%; /* 横幅を固定 */
  background: var(--card-bg); border-radius: 24px; padding: 25px;
  box-shadow: var(--glass-inner-glow);
  border: 1px solid var(--glass-border);
}

.result-bar { background: var(--glass-bg); }

#amountInput {
  border:none; background:transparent; color:var(--text-main);
  font-size:38px; font-weight:800; text-align:right; outline:none;
  width:100%; word-break: break-all; overflow-wrap: anywhere;
}

.result { font-size: 30px; font-weight: 800; line-height: 1.2; text-align: right; }

/* テンキー */
.pad { width: 320px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; flex-shrink: 0; }
.key {
  padding: 20px; border-radius: 22px;
  background: var(--key-bg); color: var(--text-main);
  border: 1px solid var(--glass-border);
  font-size: 24px; font-weight: 800; user-select: none;
}

.key.confirm { grid-column: span 3; background: var(--accent); color: var(--accent-fg); border: none; font-size: 22px; }
.key.clear { color: #ff3b30; }

.swap-btn {
  padding: 14px; border-radius: 18px; border: 1px solid var(--glass-border);
  background: var(--card-bg); color: var(--text-main); font-weight: 800;
}

.theme-toggle-btn {
  background: var(--glass-bg); border: 1px solid var(--glass-border);
  color: var(--text-main); width: 48px; height: 48px;
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 22px;
}

@media (max-width:1000px) {
  .app { flex-direction: column; align-items: center; overflow-y: auto; padding: 15px; }
  .panel { flex-direction: column; width: 100%; align-items: center; }
  .input-area { min-width: 100%; }
  .sidebar, .pad, .main { width: 100%; }
  html, body { height: auto; display: block; }
}
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar glass-panel">
    <h2 style="margin:0; font-size:12px; color:var(--text-muted); font-weight:900; letter-spacing: 1px;">通貨設定</h2>
    <select id="from"><option>取得中...</option></select>
    <select id="to"><option>取得中...</option></select>
    <button class="swap-btn" id="swap">⇅ 入れ替え</button>
  </aside>

  <main class="main glass-panel">
    <div class="top-row">
      <h1 style="margin:0; font-size:22px; font-weight:900; letter-spacing: -1px;">通貨換算</h1>
      <div style="display:flex; align-items:center; gap:15px;">
        <div id="tokyoClock" style="font-size:14px; font-weight:800; color:var(--text-muted);">--:--:--</div>
        <button class="theme-toggle-btn" id="themeToggle">☀</button>
      </div>
    </div>

    <div class="panel">
      <div class="input-area">
        <div class="amount-display">
          <div style="font-size:12px; color:var(--text-muted); font-weight:900; margin-bottom:8px;">金額</div>
          <div id="amountInput" contenteditable="true" inputmode="decimal">0</div>
        </div>
        <div class="result-bar">
          <div style="font-size:12px; color:var(--text-muted); font-weight:900; margin-bottom:8px;">換算結果</div>
          <div class="result" id="converted">0.00</div>
          <div id="rateInfo" style="font-size:14px; font-weight:600; opacity:0.8; text-align: right; margin-top: 10px;">レート取得中...</div>
        </div>
      </div>
      <div class="pad" id="numpad">
        <button class="key">7</button><button class="key">8</button><button class="key">9</button>
        <button class="key">4</button><button class="key">5</button><button class="key">6</button>
        <button class="key">1</button><button class="key">2</button><button class="key">3</button>
        <button class="key clear">C</button><button class="key">0</button><button class="key">.</button>
        <button class="key confirm" id="convertBtn">換算</button>
      </div>
    </div>
  </main>
</div>

<script>
const fromSel = document.getElementById('from'), toSel = document.getElementById('to');
const amountInput = document.getElementById('amountInput'), converted = document.getElementById('converted');
const rateInfo = document.getElementById('rateInfo'), convertBtn = document.getElementById('convertBtn');
const swapBtn = document.getElementById('swap'), themeToggle = document.getElementById('themeToggle');

themeToggle.onclick = () => {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? 'light' : 'dark');
  themeToggle.innerText = isDark ? '☀' : '☾';
};

function updateClock(){
  const t = new Intl.DateTimeFormat('ja-JP',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false,timeZone:'Asia/Tokyo'}).format(new Date());
  document.getElementById('tokyoClock').innerText = t;
}
setInterval(updateClock, 1000); updateClock();

async function loadCurrencyList() {
  try {
    const res = await fetch('https://open.er-api.com/v6/latest/USD');
    const data = await res.json();
    const codes = Object.keys(data.rates).sort();
    [fromSel, toSel].forEach(select => {
      select.innerHTML = '';
      codes.forEach(code => {
        const opt = document.createElement('option');
        opt.value = code; opt.innerText = code;
        select.appendChild(opt);
      });
    });
    fromSel.value = 'USD'; toSel.value = 'JPY';
  } catch(e) { rateInfo.innerText = '通信エラー'; }
}
loadCurrencyList();

document.getElementById('numpad').onclick = (e) => {
  const btn = e.target.closest('.key');
  if(!btn || btn.id === 'convertBtn') return;
  let val = btn.innerText, cur = amountInput.innerText;
  if(btn.classList.contains('clear')){
    amountInput.innerText = '0'; converted.innerText = '0.00'; return;
  }
  if(val === '.') {
    if(!cur.includes('.')) amountInput.innerText = cur + '.';
  } else {
    amountInput.innerText = (cur === '0') ? val : cur + val;
  }
};

swapBtn.onclick = () => {
  const tmp = fromSel.value; fromSel.value = toSel.value; toSel.value = tmp;
};

async function doConvert(){
  const amount = parseFloat(amountInput.innerText || '0');
  if(isNaN(amount) || amount <= 0) return;
  try {
    convertBtn.disabled = true; convertBtn.innerText = '...';
    const res = await fetch(`https://open.er-api.com/v6/latest/${fromSel.value}`);
    const data = await res.json();
    const rate = data.rates[toSel.value];
    const result = amount * rate;
    converted.innerText = `${result.toLocaleString(undefined,{maximumFractionDigits:4})} ${toSel.value}`;
    const d = new Date(data.time_last_update_utc * 1000).toLocaleString('ja-JP');
    rateInfo.innerHTML = `1 ${fromSel.value} = ${rate} ${toSel.value} | 更新: ${d}`;
  } catch(e) { rateInfo.innerText = '取得失敗'; }
  finally { convertBtn.disabled = false; convertBtn.innerText = '換算'; }
}
convertBtn.onclick = doConvert;
</script>
</body>
</html>