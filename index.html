<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>youtube見ながらゲーム!</title>
    <style>
        :root {
            --bg: #000000;
            --panel: rgba(28, 28, 30, 0.85);
            --accent: #a29bfe;
            --text-main: #ffffff;
            --text-sub: #8e8e93;
            --glass: rgba(255, 255, 255, 0.1);
            --radius: 22px;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: var(--bg);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            display: flex;
            width: 100vw;
            height: 100vh;
            padding: 24px;
            box-sizing: border-box;
            gap: 24px;
        }

        /* Video Section */
        .side {
            flex: 1;
            height: 100%;
            background: var(--panel);
            border-radius: var(--radius);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .header-bar {
            height: 72px;
            padding: 0 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.03);
            border-bottom: 0.5px solid var(--glass);
        }

        .header-bar input {
            flex: 1;
            background: rgba(255,255,255,0.06);
            border: none;
            border-radius: 12px;
            padding: 10px 16px;
            color: #fff;
            font-size: 14px;
            outline: none;
            transition: 0.3s;
        }

        .header-bar input:focus { background: rgba(255,255,255,0.12); }

        .btn {
            padding: 10px 20px;
            border-radius: 12px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .btn-primary { background: #fff; color: #000; }
        .btn-primary:hover { transform: scale(1.02); opacity: 0.9; }
        .btn-secondary { background: var(--glass); color: #fff; }

        .video-content { flex: 1; background: #000; }
        iframe { width: 100%; height: 100%; border: none; }

        /* Game Section */
        .game-side { position: relative; }
        .game-overlay {
            position: absolute;
            top: 24px; left: 24px; right: 24px;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .score-box { text-align: left; }
        .score-val { font-size: 48px; font-weight: 200; letter-spacing: -1px; }
        .rank-label { color: var(--accent); font-size: 12px; font-weight: 600; text-transform: uppercase; }

        .game-ctrl { position: absolute; bottom: 24px; left: 24px; display: flex; gap: 8px; pointer-events: auto; }

        /* Playlist Panel */
        .settings-btn {
            position: fixed; bottom: 40px; right: 40px;
            width: 56px; height: 56px; border-radius: 50%;
            background: #fff; color: #000;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 1000; box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            transition: 0.3s;
        }

        .panel {
            position: fixed; top: 0; right: -420px; width: 400px; height: 100%;
            background: var(--panel); backdrop-filter: blur(50px);
            border-left: 0.5px solid var(--glass);
            z-index: 999; transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
        }
        .panel.open { right: 0; }

        .panel-header { padding: 80px 32px 24px; }
        .tab-nav {
            display: flex; overflow-x: auto; gap: 8px; padding: 0 32px 16px;
            scrollbar-width: none;
        }
        .tab-btn {
            padding: 6px 14px; border-radius: 20px; background: var(--glass);
            font-size: 12px; cursor: pointer; white-space: nowrap; transition: 0.3s;
        }
        .tab-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        .list-content {
            flex: 1; overflow-y: auto; padding: 0 32px 32px;
            display: flex; flex-direction: column; gap: 8px;
        }

        .vid-card {
            background: rgba(255,255,255,0.03); border-radius: 12px;
            padding: 12px 16px; display: flex; justify-content: space-between;
            align-items: center; transition: 0.2s; cursor: pointer;
        }
        .vid-card:hover { background: rgba(255,255,255,0.08); }
        .vid-card span { font-size: 13px; color: var(--text-sub); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .del-btn { color: #ff3b30; font-size: 18px; padding: 0 5px; cursor: pointer; }

        canvas { width: 100%; height: 100%; cursor: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="side">
        <div class="header-bar">
            <input type="text" id="url-main" placeholder="Search or enter URL">
            <button class="btn btn-secondary" onclick="pasteUrl()">Paste</button>
            <button class="btn btn-primary" onclick="loadVideo('url-main')">Play</button>
        </div>
        <div class="video-content">
            <iframe id="player" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>

    <div class="side game-side" id="game-area">
        <div class="game-overlay">
            <div class="score-box">
                <div class="rank-label" id="weapon-lv">Weapon: Standard</div>
                <div class="score-val" id="score">0</div>
            </div>
        </div>
        <div class="game-ctrl">
            <button class="btn btn-secondary" id="game-toggle" onclick="toggleGame()">Start Game</button>
            <button class="btn btn-secondary" onclick="resetGame()">Reset</button>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>
</div>

<div class="settings-btn" onclick="togglePanel()">⠿</div>

<div class="panel" id="sidePanel">
    <div class="panel-header">
        <h2 style="margin:0 0 16px; font-weight: 600;">Playlists</h2>
        <div style="display:flex; gap:8px;">
            <input type="text" id="url-save" placeholder="Add to list..." style="flex:1; background:rgba(255,255,255,0.05); border:none; border-radius:10px; padding:10px; color:#fff;">
            <button class="btn btn-primary" onclick="addToList()">Add</button>
        </div>
    </div>
    <div class="tab-nav" id="tabNav"></div>
    <div class="list-content" id="listContent"></div>
</div>

<script>
    // --- Data Management ---
    const STORAGE_KEY = 'sophia_premium_v1';
    let currentListIdx = 0;
    let db = JSON.parse(localStorage.getItem(STORAGE_KEY)) || Array.from({length: 10}, (_, i) => ({ name: `List ${i+1}`, vids: [] }));

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); renderPanel(); }

    function togglePanel() { document.getElementById('sidePanel').classList.toggle('open'); }

    function renderPanel() {
        const nav = document.getElementById('tabNav');
        const content = document.getElementById('listContent');
        nav.innerHTML = ''; content.innerHTML = '';

        db.forEach((list, i) => {
            const btn = document.createElement('div');
            btn.className = `tab-btn ${i === currentListIdx ? 'active' : ''}`;
            btn.innerText = list.name;
            btn.onclick = () => { currentListIdx = i; renderPanel(); };
            nav.appendChild(btn);
        });

        db[currentListIdx].vids.forEach((id, vIdx) => {
            const card = document.createElement('div');
            card.className = 'vid-card';
            card.innerHTML = `<span onclick="playById('${id}')">YouTube ID: ${id}</span><div class="del-btn" onclick="delVid(${vIdx})">×</div>`;
            content.appendChild(card);
        });
    }

    function addToList() {
        const input = document.getElementById('url-save');
        const id = extractID(input.value);
        if (id && db[currentListIdx].vids.length < 50) {
            db[currentListIdx].vids.push(id);
            input.value = '';
            save();
        }
    }

    function delVid(idx) { db[currentListIdx].vids.splice(idx, 1); save(); }

    function extractID(url) {
        const reg = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|live\/)([^#\&\?]*).*/;
        const match = url.match(reg);
        return (match && match[2].length === 11) ? match[2] : (url.length === 11 ? url : null);
    }

    function loadVideo(id) {
        const val = document.getElementById(id).value;
        const vid = extractID(val);
        if(vid) playById(vid);
    }

    function playById(id) {
        document.getElementById('player').src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&rel=0`;
    }

    async function pasteUrl() {
        const text = await navigator.clipboard.readText();
        document.getElementById('url-main').value = text;
    }

    // --- Game Logic: Stellar Drift ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let w, h, score = 0, isRunning = false;
    let player = { x: 0, y: 0, w: 30, h: 30 };
    let bullets = [], enemies = [], stars = [];
    let weaponLv = 1;

    function initGame() {
        w = canvas.width = canvas.parentElement.clientWidth;
        h = canvas.height = canvas.parentElement.clientHeight;
        player.x = w / 2; player.y = h - 100;
        for(let i=0; i<50; i++) stars.push({x: Math.random()*w, y: Math.random()*h, s: Math.random()*2});
    }
    window.addEventListener('resize', initGame);
    initGame();

    canvas.addEventListener('mousemove', e => {
        const rect = canvas.getBoundingClientRect();
        player.x = e.clientX - rect.left;
        player.y = e.clientY - rect.top;
    });

    function toggleGame() {
        isRunning = !isRunning;
        document.getElementById('game-toggle').innerText = isRunning ? "Pause" : "Start Game";
        if(isRunning) { spawnEnemy(); autoFire(); }
    }

    function autoFire() {
        if(!isRunning) return;
        if(weaponLv === 1) bullets.push({x: player.x, y: player.y - 20, type: 'std'});
        else if(weaponLv === 2) { bullets.push({x: player.x-10, y: player.y-20}); bullets.push({x: player.x+10, y: player.y-20}); }
        else if(weaponLv === 3) { bullets.push({x: player.x, y: player.y-20}); bullets.push({x: player.x-15, y: player.y-10}); bullets.push({x: player.x+15, y: player.y-10}); }
        else { bullets.push({x: player.x, y: player.y-20, type: 'plasma'}); }
        setTimeout(autoFire, weaponLv >= 4 ? 150 : 250);
    }

    function spawnEnemy() {
        if(!isRunning) return;
        enemies.push({x: Math.random()*(w-40)+20, y: -50, hp: weaponLv});
        setTimeout(spawnEnemy, Math.max(200, 1000 - (score/20)));
    }

    function update() {
        if(!isRunning) return;
        
        // Weapon Upgrade Logic
        if(score >= 4000) { weaponLv = 4; document.getElementById('weapon-lv').innerText = "Weapon: Plasma Beam"; }
        else if(score >= 1500) { weaponLv = 3; document.getElementById('weapon-lv').innerText = "Weapon: Triple Spread"; }
        else if(score >= 500) { weaponLv = 2; document.getElementById('weapon-lv').innerText = "Weapon: Dual Shot"; }

        bullets.forEach((b, i) => { b.y -= 10; if(b.y < 0) bullets.splice(i, 1); });
        enemies.forEach((en, i) => {
            en.y += 3 + (score/1000);
            if(en.y > h) { enemies.splice(i,1); score = Math.max(0, score-50); }
            
            // Collision
            bullets.forEach((b, bi) => {
                if(Math.abs(b.x - en.x) < 25 && Math.abs(b.y - en.y) < 25) {
                    enemies.splice(i, 1); bullets.splice(bi, 1);
                    score += 100;
                }
            });
        });
        document.getElementById('score').innerText = score;
    }

    function draw() {
        ctx.fillStyle = '#000'; ctx.fillRect(0,0,w,h);
        
        // Stars
        ctx.fillStyle = '#fff';
        stars.forEach(s => { s.y += s.s; if(s.y > h) s.y = 0; ctx.fillRect(s.x, s.y, 1, 1); });

        // Player (Simple Triangle)
        ctx.shadowBlur = 15; ctx.shadowColor = varColor('--accent');
        ctx.fillStyle = varColor('--accent');
        ctx.beginPath(); ctx.moveTo(player.x, player.y-15); ctx.lineTo(player.x-15, player.y+15); ctx.lineTo(player.x+15, player.y+15); ctx.fill();

        // Bullets
        bullets.forEach(b => {
            ctx.fillStyle = b.type === 'plasma' ? '#55efc4' : '#fff';
            ctx.fillRect(b.x-2, b.y, 4, 10);
        });

        // Enemies
        ctx.shadowColor = '#ff7675'; ctx.fillStyle = '#ff7675';
        enemies.forEach(en => { ctx.fillRect(en.x-15, en.y-15, 30, 30); });
        
        ctx.shadowBlur = 0;
        update();
        requestAnimationFrame(draw);
    }

    function resetGame() { score = 0; weaponLv = 1; enemies = []; bullets = []; document.getElementById('weapon-lv').innerText = "Weapon: Standard"; }
    function varColor(n) { return getComputedStyle(document.documentElement).getPropertyValue(n).trim(); }

    renderPanel();
    draw();
</script>
</body>
</html>